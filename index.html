<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiszki Renesansowe</title>
    <link rel="stylesheet" href="style_gallery.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>

    <h1>Agatkowe Fiszki </h1>
    <div class="hint">dla Agatki i Roksanki od Piotrusia</div>

    <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
        <a href="program_nauka.html" class="nav-mode-switch">Przejd≈∫ do Trybu Nauki üéì</a>
        <a href="quiz.html" class="nav-mode-switch" style="background-color: #ff0055; color: #fff;">Sprawd≈∫ siƒô w Quizie üé≤</a>
    </div>

    <!-- Filtracja -->
    <div class="filter-container">
        <input type="text" id="search-input" placeholder="Szukaj (Autor, Tytu≈Ç)...">
        <select id="author-select">
            <option value="all">Wszyscy Arty≈õci</option>
            <!-- Opcje generowane JS -->
        </select>
        <select id="school-select">
            <option value="all">Wszystkie Szko≈Çy</option>
            <!-- Opcje generowane JS -->
        </select>
    </div>
    
    <div class="gallery" id="fiszki-container">
        </div>

    <script src="data.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js');
            });
        }
    
        // BAZA DANYCH
        // Dane pobierane z pliku data.js

        const container = document.getElementById('fiszki-container');
        const searchInput = document.getElementById('search-input');
        const schoolSelect = document.getElementById('school-select');
        const authorSelect = document.getElementById('author-select');

        // 1. Generowanie opcji filtra szk√≥≈Ç
        const uniqueSchools = [...new Set(artworkData.map(item => item.school))].sort();
        uniqueSchools.forEach(school => {
            const option = document.createElement('option');
            option.value = school;
            option.innerText = school;
            schoolSelect.appendChild(option);
        });

        // 1b. Generowanie opcji filtra autor√≥w
        const uniqueAuthors = [...new Set(artworkData.map(item => item.author))].sort();
        uniqueAuthors.forEach(author => {
            const option = document.createElement('option');
            option.value = author;
            option.innerText = author;
            authorSelect.appendChild(option);
        });

        // 2. Formatowanie daty
        function formatToCentury(dateStr) {
             const yearMatch = dateStr.match(/(\d{4})/);
             if (yearMatch) {
                 const year = parseInt(yearMatch[1]);
                 const century = Math.ceil(year / 100);
                 const half = (year % 100 === 0 || year % 100 > 50) ? "II" : "I";
                 const romans = ["", "I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX", "X", "XI", "XII", "XIII", "XIV", "XV", "XVI", "XVII", "XVIII", "XIX", "XX", "XXI"];
                 const cRoman = romans[century] || century;
                 return `${half} po≈Çowa ${cRoman} wieku`;
             }
             const textMatch = dateStr.match(/^(\d)\s*po≈Ç\.?\s*([IVX]+)\s*w\.?/i);
             if (textMatch) {
                 const halfNum = textMatch[1];
                 const centuryRom = textMatch[2];
                 const halfRom = halfNum === "1" ? "I" : "II";
                 return `${halfRom} po≈Çowa ${centuryRom} wieku`;
             }
             return dateStr;
        }

        // 3. Funkcja renderujƒÖca
        function renderGallery(data) {
            container.innerHTML = ''; // Czy≈õcimy galeriƒô

            if (data.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; font-size: 1.5rem; color: #888;">Nic nie znaleziono üïµÔ∏è‚Äç‚ôÇÔ∏è</div>';
                return;
            }

            data.forEach(item => {
                // Tworzenie element√≥w HTML
                const card = document.createElement('div');
                card.className = 'card';

                const inner = document.createElement('div');
                inner.className = 'card-inner';

                // PRZ√ìD KARTY (OBRAZ)
                const front = document.createElement('div');
                front.className = 'card-front';
                
                // Sprawdzamy czy obrazek istnieje (prostym tekstem alt)
                front.innerHTML = `<img src="${item.img}" alt="${item.title}" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <div class="placeholder" style="display:none;">Zdjƒôcie niedostƒôpne:<br>${item.img}</div>`;

                // TY≈Å KARTY (TEKST)
                const back = document.createElement('div');
                back.className = 'card-back';
                back.innerHTML = `
                    <h2>${item.title}</h2>
                    <div>
                        <span class="label">Autor:</span>
                        <p>${item.author}</p>
                    </div>
                    <div>
                        <span class="label">Data:</span>
                        <p>${formatToCentury(item.date)}</p>
                    </div>
                    <div>
                        <span class="label">Lokalizacja:</span>
                        <p>${item.location}</p>
                    </div>
                    <div>
                        <span class="label">Szko≈Ça/Technika:</span>
                        <p>${item.school}</p>
                    </div>
                `;

                // Sk≈Çadanie karty
                inner.appendChild(front);
                inner.appendChild(back);
                card.appendChild(inner);
                container.appendChild(card);

                // Obs≈Çuga klikniƒôcia (obracanie)
                card.addEventListener('click', function() {
                    this.classList.toggle('is-flipped');
                });
            });
        }

        // 4. Funkcja filtrujƒÖca
        function filterGallery() {
            const searchTerm = searchInput.value.toLowerCase();
            const schoolFilter = schoolSelect.value;
            const authorFilter = authorSelect.value;

            const filteredData = artworkData.filter(item => {
                const matchesSearch = 
                    item.title.toLowerCase().includes(searchTerm) || 
                    item.author.toLowerCase().includes(searchTerm) ||
                    item.location.toLowerCase().includes(searchTerm);
                
                const matchesSchool = schoolFilter === 'all' || item.school === schoolFilter;
                const matchesAuthor = authorFilter === 'all' || item.author === authorFilter;

                return matchesSearch && matchesSchool && matchesAuthor;
            });

            renderGallery(filteredData);
        }

        // Event Listeners
        searchInput.addEventListener('input', filterGallery);
        schoolSelect.addEventListener('change', filterGallery);
        authorSelect.addEventListener('change', filterGallery);

        // Start
        renderGallery(artworkData);
    </script>
</body>
</html>
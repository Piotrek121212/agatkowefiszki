<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiszki Renesansowe - Quiz</title>
    <link rel="stylesheet" href="style_quiz.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <h1>Agatkowe Fiszki - Quiz</h1>
    <a href="index.html" class="nav-back">WrÃ³Ä‡ do Galerii ğŸ </a>

    <!-- Setup View -->
    <div id="setup-container" class="quiz-container">
        <h2>Ustawienia Quizu</h2>
        <div class="form-group">
            <label for="question-count">Liczba pytaÅ„:</label>
            <input type="number" id="question-count" min="1" max="50" value="10">
        </div>
        <div class="form-group">
            <label for="quiz-mode">Co zgadujemy?</label>
            <select id="quiz-mode">
                <option value="title">TytuÅ‚</option>
                <option value="author">Autora</option>
                <option value="date">DatÄ™</option>
                <option value="location">LokalizacjÄ™</option>
                <option value="school">SzkoÅ‚Ä™ / TechnikÄ™</option>
            </select>
        </div>
        <button id="start-btn">Rozpocznij Quiz ğŸš€</button>
    </div>

    <!-- Quiz View -->
    <div id="quiz-container" class="quiz-container" style="display: none;">
        <div class="progress">Pytanie <span id="current-q">1</span> / <span id="total-q">10</span></div>
        <div class="image-area">
             <img id="quiz-image" src="" alt="Obraz quizu">
        </div>
        <div id="options-area" class="options-grid">
            <!-- Buttons generated via JS -->
        </div>
        <div id="feedback" class="feedback"></div>
    </div>

    <!-- Result View -->
    <div id="result-container" class="quiz-container" style="display: none;">
        <h2>Koniec Quizu! ğŸ‰</h2>
        <p>TwÃ³j wynik: <span id="score">0</span> / <span id="final-total">0</span></p>
        <button id="restart-btn">Zagraj ponownie</button>
    </div>

    <script src="data.js"></script>
    <script>
        // BAZA DANYCH 
        // Dane sÄ… teraz w data.js

        // LOGIKA QUIZU
        
        let quizQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let isAnswering = false;

        const setupContainer = document.getElementById('setup-container');
        const quizContainer = document.getElementById('quiz-container');
        const resultContainer = document.getElementById('result-container');

        const quizImage = document.getElementById('quiz-image');
        const optionsArea = document.getElementById('options-area');
        const currentQSpan = document.getElementById('current-q');
        const totalQSpan = document.getElementById('total-q');
        const feedbackDiv = document.getElementById('feedback');

        const scoreSpan = document.getElementById('score');
        const finalTotalSpan = document.getElementById('final-total');

        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');

        startBtn.addEventListener('click', startQuiz);
        restartBtn.addEventListener('click', () => {
            resultContainer.style.display = 'none';
            setupContainer.style.display = 'flex';
        });

        function startQuiz() {
            const countInput = document.getElementById('question-count');
            const modeSelect = document.getElementById('quiz-mode');
            
            let count = parseInt(countInput.value);
            const mode = modeSelect.value;

            if (count > artworkData.length) count = artworkData.length;
            if (count < 1) count = 1;

            quizQuestions = generateQuestions(count, mode);
            currentQuestionIndex = 0;
            score = 0;

            setupContainer.style.display = 'none';
            quizContainer.style.display = 'flex';
            
            renderQuestion();
        }

        function generateQuestions(count, mode) {
            // Pula wszystkich unikalnych wartoÅ›ci dla danego trybu (do losowania bÅ‚Ä™dnych odpowiedzi)
            const allValues = [...new Set(artworkData.map(item => item[mode]))];
            
            // Tasujemy dzieÅ‚a sztuki, Å¼eby wybraÄ‡ pytania
            const shuffledArtworks = shuffleArray([...artworkData]);
            const selectedArtworks = shuffledArtworks.slice(0, count);

            return selectedArtworks.map(artwork => {
                const correctAnswer = artwork[mode];
                let distractors = allValues.filter(val => val !== correctAnswer);
                
                // Losujemy 3 bÅ‚Ä™dne odpowiedzi
                distractors = shuffleArray(distractors).slice(0, 3);
                
                // DokÅ‚adamy poprawnÄ… i tasujemy opcje
                const options = shuffleArray([correctAnswer, ...distractors]);
                
                return {
                    image: artwork.img,
                    correctAnswer: correctAnswer,
                    options: options
                };
            });
        }

        function renderQuestion() {
            isAnswering = true;
            feedbackDiv.innerText = "";
            optionsArea.innerHTML = "";
            
            const q = quizQuestions[currentQuestionIndex];
            
            quizImage.src = q.image;
            currentQSpan.innerText = currentQuestionIndex + 1;
            totalQSpan.innerText = quizQuestions.length;

            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.classList.add('option-btn');
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(btn, opt, q.correctAnswer);
                optionsArea.appendChild(btn);
            });
        }

        function handleAnswer(btn, selected, correct) {
            if (!isAnswering) return;
            isAnswering = false;

            const allBtns = optionsArea.querySelectorAll('button');

            if (selected === correct) {
                score++;
                btn.classList.add('correct');
                feedbackDiv.innerText = "Dobrze! ğŸ‘";
                feedbackDiv.style.color = "#28a745";
            } else {
                btn.classList.add('wrong');
                feedbackDiv.innerText = "Å¹le ğŸ˜¢ PrawidÅ‚owa odpowiedÅº to: " + correct;
                feedbackDiv.style.color = "#dc3545";
                
                // PokaÅ¼ poprawnÄ…
                allBtns.forEach(b => {
                    if (b.innerText === correct) b.classList.add('correct');
                });
            }

            // NastÄ™pne pytanie po opÃ³Åºnieniu
            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < quizQuestions.length) {
                    renderQuestion();
                } else {
                    showResults();
                }
            }, 2000);
        }

        function showResults() {
            quizContainer.style.display = 'none';
            resultContainer.style.display = 'flex';
            scoreSpan.innerText = score;
            finalTotalSpan.innerText = quizQuestions.length;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

    </script>
</body>
</html>
